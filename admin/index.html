<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Walkr</title>
    <link rel="stylesheet" href="/styles.css">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
</head>
<body>
    <div class="notification-bar" id="notification-bar">
        <span>Important notification message here!</span>
        <button onclick="closeNotification()">X</button>
    </div>
    <header>
        <nav aria-label="Main Navigation">
            <ul class="nav-left">
                <li class="nav-home"><a href="/home/"><img src="/logo.png" alt="Home" class="nav-logo"></a></li>
            </ul>
            <ul class="nav-center">
                <li>
                    <a href="#" aria-haspopup="true" aria-expanded="false">Services</a>
                    <ul class="submenu">
                        <li><a href="/services/dog-walking/">Dog Walking</a></li>
                        <li><a href="/services/house-sitting/">House Sitting</a></li>
                    </ul>
                </li>
                <li><a href="/contact/">Contact</a></li>
                <li><a href="/about/">About</a></li>
            </ul>
            <ul class="nav-right">
                <li>
                    <a href="#" aria-haspopup="true" aria-expanded="false">Account</a>
                    <ul class="submenu">
                        <li><a href="/account/login/">Login</a></li>
                        <li><a href="/account/signup/">Signup</a></li>
                    </ul>
                </li>
            </ul>
        </nav>
    </header>
    <main>
        <div class="admin-container">
            <div id="admin-content" style="display:none;">
                <h1>Admin Page</h1>
                <p>Welcome to the admin page. This page is restricted to authorized users only.</p>
                <h2>Manage Accounts</h2>
                <table id="accounts-table">
                    <thead>
                        <tr>
                            <th>Email</th>
                            <th>Services</th>
                            <th>Location</th>
                            <th>Date Created</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Account rows will be dynamically populated -->
                    </tbody>
                </table>
                <h2>Notification Panel</h2>
                <form id="notification-form">
                    <label>
                        <input type="checkbox" id="notification-active">
                        Notification Active
                    </label>
                    <textarea id="notification-message" placeholder="Notification Message"></textarea>
                    <button type="submit">Update Notification</button>
                </form>
            </div>
            <div id="admin-login">
                <h2>Admin Login</h2>
                <input type="password" id="admin-password" placeholder="Enter Password">
                <button onclick="checkPassword()">Login</button>
                <p id="login-message"></p>
            </div>
        </div>
    </main>
    <footer>
        <p>&copy; 2024 Walkr (1.3)</p>
    </footer>
    <script>
        function checkPassword() {
            const inputPassword = document.getElementById('admin-password').value;
            fetch('/api/check-admin-password', { // Placeholder API endpoint
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ password: inputPassword })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    document.getElementById('admin-login').style.display = 'none';
                    document.getElementById('admin-content').style.display = 'block';
                } else {
                    document.getElementById('login-message').innerText = 'Incorrect password. Try again.';
                }
            })
            .catch(error => console.error('Error:', error));
        }

        function closeNotification() {
            const notificationBar = document.getElementById('notification-bar');
            notificationBar.style.animation = 'fadeOut 1s forwards';
            setTimeout(() => {
                notificationBar.style.display = 'none';
                sessionStorage.setItem('notificationClosed', 'true');
            }, 1000);
        }

        document.addEventListener('DOMContentLoaded', function () {
            if (sessionStorage.getItem('notificationClosed') === 'true') {
                document.getElementById('notification-bar').style.display = 'none';
            }

            const adminContent = document.getElementById('admin-content');
            const adminLogin = document.getElementById('admin-login');
            if (adminContent.style.display === 'none' && adminLogin.style.display === 'none') {
                adminLogin.style.display = 'flex';
                adminContent.style.display = 'none';
            }

            // Load accounts data (placeholder logic)
            function loadAccounts() {
                const accounts = [
                    {
                        email: "user1@example.com",
                        services: ["Dog Walking"],
                        location: "Melrose",
                        dateCreated: "2024-07-01 12:00"
                    },
                    {
                        email: "user2@example.com",
                        services: ["House Sitting", "Dog Walking"],
                        location: "The Neighbourhood",
                        dateCreated: "2024-07-02 15:30"
                    }
                ];

                const tbody = document.querySelector('#accounts-table tbody');
                accounts.forEach(account => {
                    const row = document.createElement('tr');

                    const emailCell = document.createElement('td');
                    emailCell.textContent = account.email;
                    row.appendChild(emailCell);

                    const servicesCell = document.createElement('td');
                    servicesCell.textContent = account.services.join(', ');
                    row.appendChild(servicesCell);

                    const locationCell = document.createElement('td');
                    locationCell.textContent = account.location;
                    row.appendChild(locationCell);

                    const dateCell = document.createElement('td');
                    dateCell.textContent = account.dateCreated;
                    row.appendChild(dateCell);

                    const actionsCell = document.createElement('td');
                    const deleteButton = document.createElement('button');
                    deleteButton.textContent = 'Delete';
                    deleteButton.onclick = function() {
                        alert('Delete functionality not implemented.');
                    };
                    actionsCell.appendChild(deleteButton);
                    row.appendChild(actionsCell);

                    tbody.appendChild(row);
                });
            }

            loadAccounts();
        });

        document.getElementById('notification-form').addEventListener('submit', function(event) {
            event.preventDefault();

            const active = document.getElementById('notification-active').checked;
            const message = document.getElementById('notification-message').value;

            fetch('/api/update-notification', { // Placeholder API endpoint
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ active, message })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('Notification settings updated.');
                } else {
                    alert('Failed to update notification settings.');
                }
            })
            .catch(error => console.error('Error:', error));
        });
    </script>
</body>
</html>
